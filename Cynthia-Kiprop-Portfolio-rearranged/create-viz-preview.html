<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quantum Climate Intelligence</title>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background: #000;
        color: #fff;
        font-family: "SF Mono", "Monaco", monospace;
        overflow: hidden;
        height: 100vh;
        perspective: 1000px;
      }

      #earthCanvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
      }

      .loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #000;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        transition: opacity 1s;
      }

      .loading-text {
        font-size: 1.2rem;
        color: #00ffea;
        margin-bottom: 2rem;
        text-align: center;
      }

      .loading-bar {
        width: 300px;
        height: 2px;
        background: rgba(0, 255, 234, 0.2);
        border-radius: 2px;
        overflow: hidden;
      }

      .loading-progress {
        width: 0%;
        height: 100%;
        background: #00ffea;
        transition: width 0.3s;
        box-shadow: 0 0 10px #00ffea;
      }

      .loading-details {
        margin-top: 2rem;
        font-size: 0.9rem;
        color: #888;
        text-align: center;
        max-width: 500px;
        line-height: 1.5;
      }

      .dashboard {
        position: relative;
        z-index: 2;
        padding: 2rem;
        height: 100vh;
        display: flex;
        flex-direction: column;
        opacity: 0;
        animation: fadeIn 1s forwards 1.5s;
      }

      @keyframes fadeIn {
        to {
          opacity: 1;
        }
      }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 2rem;
      }

      .welcome-message {
        font-size: 1.5rem;
        color: #00ffea;
        text-shadow: 0 0 10px #00ffea;
        animation: glitch 3s infinite;
      }

      @keyframes glitch {
        0%,
        100% {
          transform: translate(0);
        }
        95% {
          transform: translate(0);
        }
        96% {
          transform: translate(-2px, 2px);
        }
        97% {
          transform: translate(2px, -1px);
        }
        98% {
          transform: translate(-1px, 1px);
        }
        99% {
          transform: translate(1px, -2px);
        }
      }

      .location-info {
        text-align: right;
        color: #888;
        font-size: 0.9rem;
      }

      .location-pin {
        color: #00ffea;
        font-size: 1.2rem;
        margin-bottom: 0.5rem;
      }

      .main-content {
        display: grid;
        grid-template-columns: 300px 1fr 300px;
        gap: 2rem;
        flex: 1;
      }

      .personal-stats {
        background: rgba(0, 30, 60, 0.7);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(0, 255, 234, 0.3);
        border-radius: 15px;
        padding: 1.5rem;
        box-shadow: 0 0 30px rgba(0, 255, 234, 0.1);
      }

      .personal-title {
        color: #00ffea;
        font-size: 1.2rem;
        margin-bottom: 1.5rem;
        text-transform: uppercase;
        letter-spacing: 2px;
      }

      .stat-item {
        margin-bottom: 1.5rem;
        padding-bottom: 1.5rem;
        border-bottom: 1px solid rgba(0, 255, 234, 0.1);
      }

      .stat-label {
        color: #888;
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 0.5rem;
      }

      .stat-value {
        color: #fff;
        font-size: 1.5rem;
        font-weight: bold;
      }

      .stat-subvalue {
        color: #00ffea;
        font-size: 0.9rem;
        margin-top: 0.25rem;
      }

      .climate-visuals {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
      }

      .climate-card {
        background: rgba(0, 20, 40, 0.7);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(0, 255, 234, 0.2);
        border-radius: 15px;
        padding: 1.5rem;
        flex: 1;
      }

      .card-title {
        color: #00ffea;
        font-size: 1rem;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .temp-display {
        font-size: 4rem;
        font-weight: bold;
        text-align: center;
        margin: 1rem 0;
        color: #ff6b6b;
        text-shadow: 0 0 20px rgba(255, 107, 107, 0.5);
      }

      .temp-details {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin-top: 1rem;
      }

      .temp-item {
        text-align: center;
        padding: 1rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
      }

      .temp-label {
        color: #888;
        font-size: 0.8rem;
        margin-bottom: 0.5rem;
      }

      .temp-value {
        color: #fff;
        font-size: 1.2rem;
        font-weight: bold;
      }

      .data-stream {
        background: rgba(0, 30, 60, 0.7);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(0, 255, 234, 0.3);
        border-radius: 15px;
        padding: 1.5rem;
      }

      .stream-title {
        color: #00ffea;
        font-size: 1.2rem;
        margin-bottom: 1.5rem;
        text-transform: uppercase;
        letter-spacing: 2px;
      }

      .stream-list {
        list-style: none;
      }

      .stream-item {
        padding: 1rem;
        margin-bottom: 0.5rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        border-left: 3px solid #00ffea;
        animation: streamEntry 0.5s ease-out;
      }

      @keyframes streamEntry {
        from {
          opacity: 0;
          transform: translateX(-10px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .stream-time {
        color: #888;
        font-size: 0.8rem;
        margin-bottom: 0.25rem;
      }

      .stream-text {
        color: #fff;
        font-size: 0.9rem;
      }

      .neural-network {
        position: fixed;
        bottom: 2rem;
        left: 2rem;
        color: #00ffea;
        font-size: 0.8rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .neural-dot {
        width: 8px;
        height: 8px;
        background: #00ffea;
        border-radius: 50%;
        animation: pulse 1s infinite;
        box-shadow: 0 0 10px #00ffea;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.3;
        }
      }

      .voice-command {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        background: rgba(0, 255, 234, 0.1);
        border: 1px solid rgba(0, 255, 234, 0.3);
        border-radius: 50px;
        padding: 0.75rem 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        cursor: pointer;
        transition: all 0.3s;
      }

      .voice-command:hover {
        background: rgba(0, 255, 234, 0.2);
        transform: scale(1.05);
      }

      .voice-icon {
        width: 20px;
        height: 20px;
        background: #00ffea;
        border-radius: 50%;
        animation: voicePulse 2s infinite;
      }

      @keyframes voicePulse {
        0% {
          box-shadow: 0 0 0 0 rgba(0, 255, 234, 0.7);
        }
        70% {
          box-shadow: 0 0 0 10px rgba(0, 255, 234, 0);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(0, 255, 234, 0);
        }
      }

      .emergency-alert {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(255, 50, 50, 0.9);
        backdrop-filter: blur(20px);
        border: 2px solid #ff3232;
        border-radius: 15px;
        padding: 2rem;
        max-width: 500px;
        text-align: center;
        z-index: 1000;
        display: none;
        animation: alertPulse 2s infinite;
      }

      @keyframes alertPulse {
        0%,
        100% {
          box-shadow: 0 0 30px rgba(255, 50, 50, 0.5);
        }
        50% {
          box-shadow: 0 0 60px rgba(255, 50, 50, 0.8);
        }
      }

      .alert-title {
        color: #fff;
        font-size: 1.5rem;
        margin-bottom: 1rem;
      }

      .alert-text {
        color: #fff;
        margin-bottom: 1.5rem;
        line-height: 1.5;
      }

      .alert-close {
        background: #fff;
        color: #ff3232;
        border: none;
        padding: 0.75rem 2rem;
        border-radius: 25px;
        cursor: pointer;
        font-weight: bold;
      }

      .weather-icon {
        font-size: 3rem;
        text-align: center;
        margin: 1rem 0;
      }

      .ai-analysis {
        margin-top: 1.5rem;
        padding-top: 1.5rem;
        border-top: 1px solid rgba(0, 255, 234, 0.1);
      }

      .analysis-text {
        color: #888;
        font-size: 0.9rem;
        line-height: 1.5;
        margin-bottom: 1rem;
      }

      .analysis-impact {
        color: #00ffea;
        font-weight: bold;
      }
    </style>
  </head>
  <body class="is-loading">
    <!-- Page Loader (shows ~2s) -->
    <div
      id="page-loader"
      class="page-loader"
      role="status"
      aria-live="polite"
      aria-label="Loading"
    >
      <div class="loader-backdrop"></div>

      <div class="loader-center">
        <div class="loader-orbit" aria-hidden="true"></div>
        <div class="loader-orbit orbit-2" aria-hidden="true"></div>
        <div class="loader-orbit orbit-3" aria-hidden="true"></div>

        <div class="loader-card">
          <div class="loader-brand">
            <span class="loader-mark" aria-hidden="true"></span>
            <div class="loader-text">
              <div class="loader-name">Cynthia J Kiprop</div>
              <div class="loader-tagline">Design ‚Ä¢ Web ‚Ä¢ Data</div>
            </div>
          </div>

          <div class="loader-progress" aria-hidden="true">
            <span class="loader-bar"></span>
          </div>

          <div class="loader-hint">Loading the experience‚Ä¶</div>
        </div>
      </div>
    </div>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
      <div class="loading-text" id="loadingText">
        QUANTUM CLIMATE INTELLIGENCE INITIALIZING...
      </div>
      <div class="loading-bar">
        <div class="loading-progress" id="loadingProgress"></div>
      </div>
      <div class="loading-details" id="loadingDetails">
        Establishing secure connection... Accessing global climate networks...
      </div>
    </div>

    <!-- 3D Earth Canvas -->
    <canvas id="earthCanvas"></canvas>

    <!-- Emergency Alert -->
    <div class="emergency-alert" id="emergencyAlert">
      <div class="alert-title">‚ö†Ô∏è CLIMATE ANOMALY DETECTED</div>
      <div class="alert-text" id="alertText">
        Significant temperature deviation detected in your region.
      </div>
      <button class="alert-close" onclick="closeAlert()">ACKNOWLEDGE</button>
    </div>

    <!-- Main Dashboard -->
    <div class="dashboard">
      <header class="header">
        <div class="welcome-message" id="welcomeMessage">
          WELCOME TO QUANTUM CLIMATE INTELLIGENCE
        </div>
        <div class="location-info">
          <div class="location-pin">üìç</div>
          <div id="userLocation">Detecting your location...</div>
          <div id="localTime">--:-- --</div>
        </div>
      </header>

      <main class="main-content">
        <!-- Personal Stats Column -->
        <div class="personal-stats">
          <div class="personal-title">YOUR CLIMATE PROFILE</div>

          <div class="stat-item">
            <div class="stat-label">LOCATION</div>
            <div class="stat-value" id="statCity">--</div>
            <div class="stat-subvalue" id="statCoords">--, --</div>
          </div>

          <div class="stat-item">
            <div class="stat-label">ELEVATION</div>
            <div class="stat-value" id="statElevation">-- m</div>
            <div class="stat-subvalue" id="statElevationFt">-- ft</div>
          </div>

          <div class="stat-item">
            <div class="stat-label">TIME ZONE</div>
            <div class="stat-value" id="statTimezone">--</div>
            <div class="stat-subvalue" id="statUTC">UTC --:--</div>
          </div>

          <div class="stat-item">
            <div class="stat-label">DATA SOURCES</div>
            <div class="stat-value">8 ACTIVE</div>
            <div class="stat-subvalue">NASA ‚Ä¢ NOAA ‚Ä¢ ESA ‚Ä¢ WMO</div>
          </div>

          <div class="ai-analysis">
            <div class="analysis-text">
              <span class="analysis-impact">AI ANALYSIS:</span>
              <span id="aiAnalysisText"
                >Analyzing local climate patterns...</span
              >
            </div>
          </div>
        </div>

        <!-- Climate Visuals Center -->
        <div class="climate-visuals">
          <div class="climate-card">
            <div class="card-title">üå°Ô∏è REAL-TIME WEATHER</div>
            <div class="weather-icon" id="weatherIcon">‚òÄÔ∏è</div>
            <div class="temp-display" id="currentTemp">--¬∞C</div>
            <div class="temp-details">
              <div class="temp-item">
                <div class="temp-label">FEELS LIKE</div>
                <div class="temp-value" id="feelsLike">--¬∞C</div>
              </div>
              <div class="temp-item">
                <div class="temp-label">HUMIDITY</div>
                <div class="temp-value" id="humidity">--%</div>
              </div>
              <div class="temp-item">
                <div class="temp-label">PRESSURE</div>
                <div class="temp-value" id="pressure">-- hPa</div>
              </div>
              <div class="temp-item">
                <div class="temp-label">WIND</div>
                <div class="temp-value" id="windSpeed">-- m/s</div>
              </div>
            </div>
          </div>

          <div class="climate-card">
            <div class="card-title">üìä CLIMATE IMPACT ASSESSMENT</div>
            <div id="climateImpact">Loading climate data...</div>
          </div>
        </div>

        <!-- Data Stream Column -->
        <div class="data-stream">
          <div class="stream-title">LIVE DATA STREAM</div>
          <ul class="stream-list" id="streamList">
            <li class="stream-item">
              <div class="stream-time">--:--:--</div>
              <div class="stream-text">System initializing...</div>
            </li>
          </ul>
        </div>
      </main>

      <div class="neural-network">
        <div class="neural-dot"></div>
        NEURAL NETWORK: ACTIVE
      </div>

      <div class="voice-command" onclick="toggleVoiceCommand()">
        <div class="voice-icon"></div>
        VOICE COMMAND
      </div>
    </div>

    <script>
      // Initialize global variables
      let userLocation = {};
      let threeScene, camera, renderer, earthMesh;
      let voiceActive = false;
      let recognition;

      // Loading sequence
      const loadingTexts = [
        "Establishing quantum link...",
        "Accessing satellite networks...",
        "Analyzing atmospheric data...",
        "Connecting to global climate database...",
        "Calibrating sensors for your location...",
        "Initializing neural network...",
        "Syncing with space stations...",
        "Ready to deploy quantum intelligence...",
      ];

      // Simulate loading sequence
      simulateLoading();

      async function simulateLoading() {
        const loadingScreen = document.getElementById("loadingScreen");
        const loadingText = document.getElementById("loadingText");
        const loadingProgress = document.getElementById("loadingProgress");
        const loadingDetails = document.getElementById("loadingDetails");

        // Step 1: Detect location
        loadingText.textContent = "ACCESSING LOCATION DATA...";
        loadingProgress.style.width = "10%";

        try {
          // Try to get precise location
          const position = await getLocation();
          userLocation = {
            lat: position.coords.latitude,
            lon: position.coords.longitude,
            accuracy: position.coords.accuracy,
          };

          // Reverse geocode to get city/country
          await reverseGeocode(userLocation.lat, userLocation.lon);
        } catch (error) {
          // Fallback to IP-based location
          console.log("Geolocation failed, using IP fallback");
          await getLocationByIP();
        }

        // Step 2: Initialize 3D Earth
        loadingText.textContent = "RENDERING GLOBAL CLIMATE MODEL...";
        loadingProgress.style.width = "30%";
        init3DEarth();

        // Step 3: Fetch weather data
        loadingText.textContent = "DOWNLOADING REAL-TIME WEATHER DATA...";
        loadingProgress.style.width = "50%";
        await fetchWeatherData();

        // Step 4: Fetch climate data
        loadingText.textContent = "ANALYZING HISTORICAL CLIMATE PATTERNS...";
        loadingProgress.style.width = "70%";
        await fetchClimateData();

        // Step 5: AI Analysis
        loadingText.textContent = "RUNNING QUANTUM AI ANALYSIS...";
        loadingProgress.style.width = "85%";
        generateAIAnalysis();

        // Step 6: Finalize
        loadingText.textContent = "SYSTEM READY";
        loadingProgress.style.width = "100%";

        // Show welcome with user's name
        setTimeout(() => {
          loadingScreen.style.opacity = "0";
          setTimeout(() => {
            loadingScreen.style.display = "none";
            updateWelcomeMessage();
            startDataStream();
            checkForAlerts();
          }, 1000);
        }, 1000);
      }

      // Get user location with high precision
      function getLocation() {
        return new Promise((resolve, reject) => {
          if (!navigator.geolocation) {
            reject("Geolocation not supported");
            return;
          }

          navigator.geolocation.getCurrentPosition(
            (position) => {
              console.log("Precise location obtained:", position.coords);
              resolve(position);
            },
            (error) => {
              console.warn("High-precision location failed:", error.message);
              reject(error);
            },
            {
              enableHighAccuracy: true,
              timeout: 10000,
              maximumAge: 0,
            }
          );
        });
      }

      // Fallback: Get location by IP
      async function getLocationByIP() {
        try {
          const response = await fetch("https://ipapi.co/json/");
          const data = await response.json();

          userLocation = {
            lat: data.latitude,
            lon: data.longitude,
            city: data.city,
            country: data.country_name,
            accuracy: 50000, // IP-based location is less accurate
          };

          updateLocationDisplay();
        } catch (error) {
          console.error("IP location failed:", error);
          // Final fallback: Use default location (New York)
          userLocation = {
            lat: 40.7128,
            lon: -74.006,
            city: "New York",
            country: "United States",
            accuracy: 100000,
          };
          updateLocationDisplay();
        }
      }

      // Reverse geocode coordinates to get location details
      async function reverseGeocode(lat, lon) {
        try {
          const response = await fetch(
            `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`
          );
          const data = await response.json();

          if (data.address) {
            userLocation.city =
              data.address.city || data.address.town || data.address.village;
            userLocation.country = data.address.country;
            userLocation.state = data.address.state;

            // Get elevation
            await getElevation(lat, lon);

            updateLocationDisplay();
          }
        } catch (error) {
          console.error("Reverse geocoding failed:", error);
        }
      }

      // Get elevation data
      async function getElevation(lat, lon) {
        try {
          const response = await fetch(
            `https://api.open-elevation.com/api/v1/lookup?locations=${lat},${lon}`
          );
          const data = await response.json();

          if (data.results && data.results.length > 0) {
            userLocation.elevation = data.results[0].elevation;
            document.getElementById(
              "statElevation"
            ).textContent = `${Math.round(userLocation.elevation)} m`;
            document.getElementById(
              "statElevationFt"
            ).textContent = `${Math.round(userLocation.elevation * 3.281)} ft`;
          }
        } catch (error) {
          console.error("Elevation API failed:", error);
        }
      }

      // Initialize 3D Earth with user's location highlighted
      function init3DEarth() {
        const canvas = document.getElementById("earthCanvas");

        // Scene setup
        threeScene = new THREE.Scene();

        // Camera setup
        camera = new THREE.PerspectiveCamera(
          45,
          window.innerWidth / window.innerHeight,
          0.1,
          1000
        );
        camera.position.z = 5;

        // Renderer setup
        renderer = new THREE.WebGLRenderer({
          canvas,
          alpha: true,
          antialias: true,
        });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);

        // Add stars
        const starGeometry = new THREE.BufferGeometry();
        const starCount = 5000;
        const positions = new Float32Array(starCount * 3);

        for (let i = 0; i < starCount * 3; i += 3) {
          positions[i] = (Math.random() - 0.5) * 2000;
          positions[i + 1] = (Math.random() - 0.5) * 2000;
          positions[i + 2] = (Math.random() - 0.5) * 2000;
        }

        starGeometry.setAttribute(
          "position",
          new THREE.BufferAttribute(positions, 3)
        );
        const starMaterial = new THREE.PointsMaterial({
          color: 0xffffff,
          size: 0.7,
        });
        const stars = new THREE.Points(starGeometry, starMaterial);
        threeScene.add(stars);

        // Create Earth
        const earthGeometry = new THREE.SphereGeometry(2, 64, 64);
        const earthMaterial = new THREE.MeshPhongMaterial({
          color: 0x2233ff,
          shininess: 5,
          transparent: true,
          opacity: 0.9,
        });

        earthMesh = new THREE.Mesh(earthGeometry, earthMaterial);
        threeScene.add(earthMesh);

        // Add clouds layer
        const cloudGeometry = new THREE.SphereGeometry(2.05, 64, 64);
        const cloudMaterial = new THREE.MeshPhongMaterial({
          color: 0xffffff,
          transparent: true,
          opacity: 0.3,
        });
        const cloudMesh = new THREE.Mesh(cloudGeometry, cloudMaterial);
        threeScene.add(cloudMesh);

        // Add user location marker
        if (userLocation.lat && userLocation.lon) {
          const markerGeometry = new THREE.SphereGeometry(0.1, 16, 16);
          const markerMaterial = new THREE.MeshBasicMaterial({
            color: 0xff0000,
          });
          const marker = new THREE.Mesh(markerGeometry, markerMaterial);

          // Convert lat/lon to 3D position
          const phi = (90 - userLocation.lat) * (Math.PI / 180);
          const theta = (userLocation.lon + 180) * (Math.PI / 180);

          marker.position.x = -(2.1 * Math.sin(phi) * Math.cos(theta));
          marker.position.y = 2.1 * Math.cos(phi);
          marker.position.z = 2.1 * Math.sin(phi) * Math.sin(theta);

          threeScene.add(marker);

          // Add light from user's location
          const pointLight = new THREE.PointLight(0xff0000, 2, 10);
          pointLight.position.copy(marker.position);
          threeScene.add(pointLight);
        }

        // Add lights
        const ambientLight = new THREE.AmbientLight(0x333333);
        threeScene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
        directionalLight.position.set(5, 3, 5);
        threeScene.add(directionalLight);

        // Animation loop
        function animate() {
          requestAnimationFrame(animate);

          // Rotate Earth slowly
          earthMesh.rotation.y += 0.001;
          cloudMesh.rotation.y += 0.0015;

          renderer.render(threeScene, camera);
        }

        animate();

        // Handle window resize
        window.addEventListener("resize", () => {
          camera.aspect = window.innerWidth / window.innerHeight;
          camera.updateProjectionMatrix();
          renderer.setSize(window.innerWidth, window.innerHeight);
        });
      }

      // Fetch real weather data
      async function fetchWeatherData() {
        if (!userLocation.lat || !userLocation.lon) return;

        try {
          // Using OpenWeatherMap API (you would need an API key for production)
          // For demo purposes, we'll simulate data
          simulateWeatherData();

          // Real API call would look like:
          // const apiKey = 'YOUR_API_KEY';
          // const response = await fetch(
          //     `https://api.openweathermap.org/data/2.5/weather?lat=${userLocation.lat}&lon=${userLocation.lon}&appid=${apiKey}&units=metric`
          // );
          // const data = await response.json();
          // updateWeatherDisplay(data);
        } catch (error) {
          console.error("Weather API failed:", error);
          simulateWeatherData(); // Fallback to simulation
        }
      }

      // Simulate weather data (for demo)
      function simulateWeatherData() {
        const weatherConditions = [
          {
            icon: "‚òÄÔ∏è",
            temp: 22,
            feels: 21,
            humidity: 45,
            pressure: 1013,
            wind: 3.5,
            desc: "Clear sky",
          },
          {
            icon: "‚õÖ",
            temp: 18,
            feels: 17,
            humidity: 60,
            pressure: 1010,
            wind: 4.2,
            desc: "Partly cloudy",
          },
          {
            icon: "‚òÅÔ∏è",
            temp: 15,
            feels: 14,
            humidity: 75,
            pressure: 1008,
            wind: 5.1,
            desc: "Cloudy",
          },
          {
            icon: "üåßÔ∏è",
            temp: 12,
            feels: 10,
            humidity: 85,
            pressure: 1005,
            wind: 6.3,
            desc: "Light rain",
          },
          {
            icon: "‚õàÔ∏è",
            temp: 16,
            feels: 15,
            humidity: 70,
            pressure: 1007,
            wind: 7.8,
            desc: "Thunderstorm",
          },
        ];

        const weather =
          weatherConditions[
            Math.floor(Math.random() * weatherConditions.length)
          ];

        // Apply some location-based variations
        if (userLocation.lat > 0) {
          // Northern hemisphere
          weather.temp += Math.random() * 5;
        } else {
          // Southern hemisphere
          weather.temp -= Math.random() * 5;
        }

        updateWeatherDisplay(weather);
      }

      // Update weather display
      function updateWeatherDisplay(data) {
        document.getElementById("weatherIcon").textContent = data.icon;
        document.getElementById("currentTemp").textContent = `${data.temp}¬∞C`;
        document.getElementById("feelsLike").textContent = `${data.feels}¬∞C`;
        document.getElementById("humidity").textContent = `${data.humidity}%`;
        document.getElementById(
          "pressure"
        ).textContent = `${data.pressure} hPa`;
        document.getElementById("windSpeed").textContent = `${data.wind} m/s`;
      }

      // Fetch climate data
      async function fetchClimateData() {
        // Simulate climate data based on location
        const impacts = [
          "Sea level rise: 0.5-1m by 2100",
          "Increased flood frequency: 2x in last decade",
          "Heat wave frequency: Increased by 300% since 1980",
          "Wildfire risk: High in dry seasons",
          "Agricultural impact: Growing season extended by 15 days",
        ];

        const selectedImpacts = impacts.slice(
          0,
          2 + Math.floor(Math.random() * 3)
        );
        document.getElementById("climateImpact").innerHTML = selectedImpacts
          .map(
            (impact) =>
              `<div style="margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px;">‚ö†Ô∏è ${impact}</div>`
          )
          .join("");
      }

      // Generate AI analysis
      function generateAIAnalysis() {
        const analyses = [
          "Your region shows a warming trend of 0.3¬∞C per decade, above global average.",
          "Local climate patterns indicate increased precipitation variability.",
          "Based on current trends, expect 15 more tropical nights per year by 2050.",
          "Your location's carbon footprint is 20% above national average.",
          "Renewable energy potential: High for solar, moderate for wind.",
          "Climate resilience score: 68/100 (moderate vulnerability).",
        ];

        const analysis = analyses[Math.floor(Math.random() * analyses.length)];
        document.getElementById("aiAnalysisText").textContent = analysis;
      }

      // Update location display
      function updateLocationDisplay() {
        document.getElementById("statCity").textContent =
          userLocation.city || "Unknown City";
        document.getElementById("statCoords").textContent = `${
          userLocation.lat?.toFixed(4) || "--"
        }, ${userLocation.lon?.toFixed(4) || "--"}`;

        document.getElementById("userLocation").innerHTML = `<strong>${
          userLocation.city || "Unknown"
        }</strong><br>${userLocation.country || "Unknown Country"}`;

        // Update time
        updateLocalTime();
        setInterval(updateLocalTime, 60000);
      }

      // Update local time
      function updateLocalTime() {
        const now = new Date();
        document.getElementById("localTime").textContent =
          now.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });

        // Get timezone
        const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
        document.getElementById("statTimezone").textContent =
          timezone.split("/")[1] || timezone;
        document.getElementById("statUTC").textContent = `UTC ${
          now.getTimezoneOffset() / -60
        }:00`;
      }

      // Update welcome message
      function updateWelcomeMessage() {
        const hour = new Date().getHours();
        let greeting;

        if (hour < 12) greeting = "Good morning";
        else if (hour < 18) greeting = "Good afternoon";
        else greeting = "Good evening";

        const name = localStorage.getItem("userName") || "User";
        document.getElementById(
          "welcomeMessage"
        ).textContent = `${greeting}, ${name}. QUANTUM CLIMATE INTELLIGENCE ACTIVE`;
      }

      // Start live data stream
      function startDataStream() {
        const streamList = document.getElementById("streamList");

        // Clear initial item
        streamList.innerHTML = "";

        // Add data stream entries
        const streamEntries = [
          `Quantum link established with ${
            userLocation.city || "your location"
          }`,
          `Atmospheric analysis: CO2 levels at 415 ppm, trending upward`,
          `Satellite telemetry: Temperature anomaly +1.2¬∞C above pre-industrial`,
          `Ocean sensors: Sea surface temperature rising 0.13¬∞C per decade`,
          `Ice core data: Methane levels at 1900 ppb, all-time high`,
          `Global network: Synced with 8 international climate databases`,
          `AI prediction: 97% confidence in continued warming trend`,
          `Renewable index: Solar potential in your area is 85% optimal`,
        ];

        let delay = 0;
        streamEntries.forEach((entry, index) => {
          setTimeout(() => {
            addStreamEntry(entry);

            // Every 3rd entry, simulate an "alert"
            if (index % 3 === 0 && index > 0) {
              setTimeout(() => {
                simulateAlert(entry);
              }, 1000);
            }
          }, delay);
          delay += 2000 + Math.random() * 3000;
        });

        // Continue adding random entries
        setInterval(() => {
          const randomEntries = [
            `Neural network update: Climate pattern recognition improved to 94% accuracy`,
            `Real-time sensor: Local temperature fluctuation detected`,
            `Data correlation: Your region's warming correlates with global models`,
            `Satellite pass: New thermal imaging data received`,
            `Quantum processor: Running 1.2 petaflops of climate simulations`,
            `Carbon tracker: Global emissions at 36.8 gigatons this year`,
          ];

          const randomEntry =
            randomEntries[Math.floor(Math.random() * randomEntries.length)];
          addStreamEntry(randomEntry);
        }, 10000);
      }

      // Add entry to data stream
      function addStreamEntry(text) {
        const streamList = document.getElementById("streamList");
        const now = new Date();
        const timeString = now.toLocaleTimeString([], {
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit",
        });

        const entry = document.createElement("li");
        entry.className = "stream-item";
        entry.innerHTML = `
                <div class="stream-time">${timeString}</div>
                <div class="stream-text">${text}</div>
            `;

        streamList.prepend(entry);

        // Limit to 10 entries
        if (streamList.children.length > 10) {
          streamList.removeChild(streamList.lastChild);
        }

        // Add visual effect
        entry.style.animation = "none";
        setTimeout(() => {
          entry.style.animation = "streamEntry 0.5s ease-out";
        }, 10);
      }

      // Check for climate alerts
      function checkForAlerts() {
        // 20% chance of an alert
        if (Math.random() > 0.8) {
          setTimeout(() => {
            const alerts = [
              `Temperature in ${
                userLocation.city || "your region"
              } is 3.2¬∞C above seasonal average`,
              `High pollution alert: Air quality index reaching unhealthy levels`,
              `Extreme weather warning: Storm system detected approaching your area`,
              `Drought conditions developing: 40% below average precipitation`,
              `Heat wave alert: 3 consecutive days above 35¬∞C predicted`,
            ];

            const alert = alerts[Math.floor(Math.random() * alerts.length)];
            showAlert(alert);
          }, 5000);
        }
      }

      // Simulate alert from data stream
      function simulateAlert(streamText) {
        const alertTexts = {
          "Temperature anomaly": `Significant temperature deviation detected in ${
            userLocation.city || "your region"
          }`,
          "CO2 levels": `Atmospheric CO2 concentrations reaching critical levels`,
          "Sea surface temperature": `Ocean warming accelerating faster than models predicted`,
          "Methane levels": `Methane spike detected, potent greenhouse gas increasing rapidly`,
        };

        for (const [key, alert] of Object.entries(alertTexts)) {
          if (streamText.includes(key)) {
            showAlert(alert);
            break;
          }
        }
      }

      // Show emergency alert
      function showAlert(message) {
        document.getElementById("alertText").textContent = message;
        document.getElementById("emergencyAlert").style.display = "block";

        // Auto-close after 10 seconds
        setTimeout(() => {
          if (
            document.getElementById("emergencyAlert").style.display === "block"
          ) {
            closeAlert();
          }
        }, 10000);
      }

      function closeAlert() {
        document.getElementById("emergencyAlert").style.display = "none";
      }

      // Voice command system
      function toggleVoiceCommand() {
        if (!voiceActive) {
          startVoiceRecognition();
        } else {
          stopVoiceRecognition();
        }
      }

      function startVoiceRecognition() {
        if (
          !("webkitSpeechRecognition" in window) &&
          !("SpeechRecognition" in window)
        ) {
          addStreamEntry("Voice recognition not supported in this browser");
          return;
        }

        const SpeechRecognition =
          window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.lang = "en-US";

        recognition.onstart = function () {
          voiceActive = true;
          addStreamEntry("Voice command: Listening...");
        };

        recognition.onresult = function (event) {
          const transcript = event.results[0][0].transcript.toLowerCase();
          addStreamEntry(`Voice command: "${transcript}"`);
          processVoiceCommand(transcript);
        };

        recognition.onerror = function (event) {
          addStreamEntry(`Voice recognition error: ${event.error}`);
          voiceActive = false;
        };

        recognition.onend = function () {
          voiceActive = false;
        };

        recognition.start();
      }

      function stopVoiceRecognition() {
        if (recognition) {
          recognition.stop();
          voiceActive = false;
          addStreamEntry("Voice command: Stopped");
        }
      }

      function processVoiceCommand(command) {
        const responses = {
          temperature: `Current temperature is ${
            document.getElementById("currentTemp").textContent
          }`,
          weather: `Weather conditions: ${
            document.getElementById("weatherIcon").textContent
          }`,
          location: `You are in ${userLocation.city || "unknown location"}, ${
            userLocation.country || "unknown country"
          }`,
          climate:
            "Climate impact assessment shows moderate vulnerability to extreme weather events",
          help: "Available commands: temperature, weather, location, climate, alert, refresh",
          alert: "Checking for climate alerts in your region...",
          refresh: "Refreshing climate data from global networks...",
        };

        let response =
          "Command not recognized. Try: temperature, weather, location, climate";

        for (const [key, value] of Object.entries(responses)) {
          if (command.includes(key)) {
            response = value;

            if (key === "alert") {
              setTimeout(() => {
                checkForAlerts();
              }, 1000);
            } else if (key === "refresh") {
              setTimeout(() => {
                fetchWeatherData();
                fetchClimateData();
                addStreamEntry("Climate data refreshed from global networks");
              }, 1000);
            }

            break;
          }
        }

        // Simulate voice response
        speakResponse(response);
      }

      function speakResponse(text) {
        if ("speechSynthesis" in window) {
          const utterance = new SpeechSynthesisUtterance(text);
          utterance.rate = 1.0;
          utterance.pitch = 1.0;
          utterance.volume = 1.0;
          speechSynthesis.speak(utterance);
        }
      }

      // Add click effect to Earth
      document
        .getElementById("earthCanvas")
        .addEventListener("click", function (event) {
          const rect = this.getBoundingClientRect();
          const x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
          const y = -((event.clientY - rect.top) / rect.height) * 2 + 1;

          addStreamEntry(
            "Quantum click detected: Analyzing global climate patterns at clicked coordinates"
          );

          // Create ripple effect
          const ripple = document.createElement("div");
          ripple.style.position = "fixed";
          ripple.style.left = `${event.clientX}px`;
          ripple.style.top = `${event.clientY}px`;
          ripple.style.width = "0px";
          ripple.style.height = "0px";
          ripple.style.border = "2px solid rgba(0, 255, 234, 0.5)";
          ripple.style.borderRadius = "50%";
          ripple.style.pointerEvents = "none";
          ripple.style.zIndex = "1000";
          document.body.appendChild(ripple);

          // Animate ripple
          let size = 0;
          const animateRipple = () => {
            size += 10;
            ripple.style.width = `${size}px`;
            ripple.style.height = `${size}px`;
            ripple.style.left = `${event.clientX - size / 2}px`;
            ripple.style.top = `${event.clientY - size / 2}px`;
            ripple.style.opacity = `${1 - size / 200}`;

            if (size < 200) {
              requestAnimationFrame(animateRipple);
            } else {
              document.body.removeChild(ripple);
            }
          };

          animateRipple();
        });

      // Add keyboard shortcuts
      document.addEventListener("keydown", function (event) {
        if (event.ctrlKey && event.key === " ") {
          event.preventDefault();
          toggleVoiceCommand();
        } else if (event.key === "Escape") {
          closeAlert();
        } else if (event.key === "r" || event.key === "R") {
          if (event.ctrlKey) {
            event.preventDefault();
            fetchWeatherData();
            fetchClimateData();
            addStreamEntry("Manual refresh: Updated all climate data");
          }
        }
      });

      // Initial data stream entry
      setTimeout(() => {
        addStreamEntry("Quantum Climate Intelligence System Online");
        addStreamEntry(
          `User location detected: ${userLocation.city || "Unknown"}, ${
            userLocation.country || "Unknown"
          }`
        );
        addStreamEntry(
          "Initializing neural network for personalized climate analysis"
        );
      }, 2000);
    </script>
  </body>
</html>
